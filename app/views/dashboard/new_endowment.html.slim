= stylesheet_link_tag "bootstrap/bootstrap.min.css", "jui/jquery-ui.css", "jui/jquery-ui.custom.css", "jui/timepicker/jquery-ui-timepicker.css", "plugins/uniform/uniform.default.css", "custom-plugins/wizard/wizard.css", "fonts/icomoon/style.css", "main-style.css"

= javascript_include_tag "libs/jquery-1.8.3.min.js", "bootstrap/bootstrap.min.js", "libs/jquery.placeholder.min.js", "libs/jquery.mousewheel.min.js", "template.js", "setup.js", "customizer.js", "plugins/uniform/jquery.uniform.min.js", "jui/jquery-ui-1.9.2.min.js", "jui/jquery-ui.custom.min.js", "jui/timepicker/jquery-ui-timepicker.min.js", "jui/jquery.ui.touch-punch.min.js", "plugins/validate/jquery.validate.min.js", "custom-plugins/wizard/wizard.js", "custom-plugins/wizard/jquery.form.min.js", "demo/form_wizard.js"

css:
  .btn-toolbar-hidden{
    display: none;
  }

#sidebar-separator
section#main.clearfix
  #main-header.page-header
    ul.breadcrumb
      li
        i.icon-home>
        | MoonCake
        span.divider &raquo;
      li
        a href="#"
        span.divider &raquo;
      li
        a href="#"
    h1#main-heading
      | Form Wizard
      span Example usage of the custom build wizard plugin
  #main-content
    .row-fluid
      .span12.widget
        .widget-header
          span.title
            i.icol-wand
            | Wizard with Validation
          .toolbar
            .btn-group
              span.btn data-content="" data-html="true" data-placement="left" data-trigger="hover" rel="popover" title="Wizard With Validation"
            = "Show Data Attributes"
        .widget-content.form-container
          = form_tag create_endowment_path, id: "wizard-demo-2", class: "form-horizontal form-endowment", method: :post, remote: true do
            fieldset.wizard-step
              legend.wizard-label
                i.icon-book
                | Charity Group
              .control-group
                label.control-label
                  | Endowment Name
                  span.required *
                .controls
                  input.required.span12 name="endowment[name]" type="text" id="name"
              .control-group
                label.control-label
                  | Minimum Donation Amount
                  span.required *
                .controls
                  input.required.span12 name="endowment[minimum_donation_amount]" type="text" id="minimum_donation_amount"
              .control-group
                label.control-label
                  | Visibility
                  span.required *
                .controls id="endowment_visibility"
                  label.radio
                    input.required name="endowment[endowment_visibility]" type="radio" id= "public" public
                  label.radio
                    input.required name="endowment[endowment_visibility]" type="radio" id= "private" private
              .form-actions.btn-toolbar
                = submit_tag "Next", class: "btn hidden", id: "endowsment-submit"
                = link_to "Next â–º", "javascript:void(0)", class: "btn endowment-save-continue", style: "position: relative;display:block;margin:0 auto;width: 262px;"

            fieldset.wizard-step
              legend.wizard-label
                i.icon-user
                | Add Charity to Group
              .control-group
                label.control-label
                  | Charity Id
                  span.required *
                .controls
                  input.required.span12 name="[charity_id]" type="text" id="charity_id"
              .form-actions.btn-toolbar
                = submit_tag "Next", class: "btn hidden", id: "endowsment-submit"
                = link_to "Create Endowment", "javascript:void(0)", class: "btn add-charity", style: "position: relative;display:block;margin:0 auto;width: 262px;"

            fieldset.wizard-step
              legend.wizard-label
                i.icon-ok
                | Subscribe/ Donate Page
              .control-group
                label.control-label
                  = "Endowment created!"

javascript:
  $(document).ready(function() {
    $('.endowment-save-continue').on('click', function(e) {
      e.preventDefault();
      if (!$(".form-endowment").valid()) return;
      $("input.endowment-save-continue").val("LOADING..");
      $(this).text("LOADING..");

      $('.form-actions').find('button:contains(Next)').click();
    });

    $('.add-charity').on('click', function(e) {
      e.preventDefault();
      if (!$(".form-endowment").valid()) return;
      $("input.add-charity").val("LOADING..");
      $(this).text("LOADING..");
      var token = "#{session[:token]}";
      var name = $('#name').val();
      var minimum_donation_amount = $('#minimum_donation_amount').val();
      var val1 = $("#public").is(":checked");
      var endowment_visibility = (val1 == true ? "public" : "private");
      var charity_id = $('#charity_id').val();

      var data = {
        name: name,
        minimum_donation_amount: minimum_donation_amount,
        endowment_visibility: endowment_visibility,
        charity_id: charity_id
      };

      $.ajax({
        beforeSend: function(xhr) {
          xhr.setRequestHeader("Authorization", token);
        },
        type: 'POST',
        url: '#{request.protocol}' + document.location.hostname + ":" + document.location.port + '/create_endowment',
        data: data
      }).done(function(id) {
        $('.form-actions').find('button:contains(Next)').click()
      });
    });
  });
